# ===========================================
# API Gateway Configuration
# ===========================================

# Server port
server.port=8080

# Application name
spring.application.name=apigateway

# ===========================================
# Eureka Client Configuration
# ===========================================

# Đăng ký với Eureka Server
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# Instance configuration
eureka.instance.hostname=localhost
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# ===========================================
# Gateway Configuration
# ===========================================

# Gateway discovery locator
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ===========================================
# Load Balancer Configuration
# ===========================================

# Load balancer configuration
spring.cloud.loadbalancer.ribbon.enabled=false

# ===========================================
# CORS Configuration
# ===========================================

# CORS settings
spring.webflux.cors.allowed-origins=*
spring.webflux.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.webflux.cors.allowed-headers=*
spring.webflux.cors.allow-credentials=true

# ===========================================
# Logging Configuration
# ===========================================

# Log level cho Gateway
logging.level.com.predict_app.apigateway=INFO
logging.level.org.springframework.cloud.gateway=INFO
logging.level.org.springframework.web.reactive=DEBUG

# ===========================================
# Management & Monitoring
# ===========================================

# Actuator endpoints
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.health.show-details=always

# Gateway actuator
management.endpoint.gateway.enabled=true

# ===========================================
# JWT Configuration
# ===========================================

# JWT secret key
jwt.secret=2L7OaWJq8w3sM7vM8q5Gq0Wz6JfYzI6aQyd0NgqfFs8=
jwt.expiration=86400000

# ===========================================
# Circuit Breaker
# ===========================================

# Circuit breaker configuration
# spring.cloud.gateway.routes[0].filters[0]=CircuitBreaker=myCircuitBreaker

# ===========================================
# Redis Configuration
# ===========================================

# Redis connection (override via env REDIS_HOST/REDIS_PORT)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}

# ===========================================
# Gateway Routes & Rate Limiting
# ===========================================

spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=lb://authservice
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.routes[0].filters[0]=AddRequestHeader=X-Gateway-Source,api-gateway

spring.cloud.gateway.routes[1].id=user-service
spring.cloud.gateway.routes[1].uri=lb://userservice
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/users/**
spring.cloud.gateway.routes[1].filters[0]=AddRequestHeader=X-Gateway-Source,api-gateway
spring.cloud.gateway.routes[1].filters[1].name=RequestRateLimiter
spring.cloud.gateway.routes[1].filters[1].args.redis-rate-limiter.replenishRate=10
spring.cloud.gateway.routes[1].filters[1].args.redis-rate-limiter.burstCapacity=20
spring.cloud.gateway.routes[1].filters[1].args.redis-rate-limiter.requestedTokens=1
spring.cloud.gateway.routes[1].filters[1].args.key-resolver=#{@ipKeyResolver}
spring.cloud.gateway.routes[1].filters[2].name=JwtAuthenticationFilter